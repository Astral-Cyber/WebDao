import{e as W,f as Z,g as ee,h as te,k as ae,p as oe,i as le,j as ne,q as se,E as d}from"./element-plus.e0eb975d.js";import{u as re}from"./vue-router.c65c7731.js";import{_ as ie,u as ue,r as P}from"./index.4b51825e.js";import{o as de}from"./@element-plus.5f041e4b.js";import{h as y,G as pe,ac as x,o as O,c as U,V as t,T as a,u as E,Q as N,ae as ce,a5 as p,a as f,X as h,a8 as fe,a$ as me,a_ as ge}from"./@vue.0557ba9e.js";import"./@vueuse.5213622e.js";import"./@ctrl.fd318bfa.js";import"./@popperjs.36402333.js";import"./lodash-es.b61273cf.js";import"./js-md5.4abe9502.js";import"./@kangc.2fcddba3.js";import"./vue.a9c6bc3a.js";import"./highlight.js.7457627b.js";import"./codemirror.4c664187.js";import"./sakana-widget.756df383.js";function q(m){let g=m.getFullYear().toString(),r=(m.getMonth()+1).toString(),w=m.getDate().toString();return`${g}-${r}-${w}`}const _e=m=>(me("data-v-267b2c31"),m=m(),ge(),m),ve=_e(()=>f("span",{id:"title",style:{"font-weight":"bolder","font-size":"24px",color:"#666666"}},"Editor",-1)),he={class:"dialog-footer"},ye={style:{"font-weight":"bolder",color:"#666666","font-size":"x-large"}},we=["src"],be={style:{top:"0",color:"#666666","font-weight":"bolder","font-size":"24px","word-break":"break-all",overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"1","-webkit-box-orient":"vertical",margin:"0 0 10px","word-wrap":"break-word"}},xe={style:{height:"150px",width:"auto"}},De={class:"introCard"},$e={style:{color:"#777777","font-size":"small",bottom:"10px",position:"absolute",width:"55%"}},Ee={__name:"DraftView",setup(m){const g=y(!1),r=ue(),w=re(),_=y(),T=y([]),D=y([]),V=y(parseInt(w.params.page||1));let j="https://api.ixiaowai.cn/gqapi/gqapi.php";const o=y({id:"",authorUuid:r.$userInfo.value.id,topic:"",content:"",intro:"",assort:"",author:r.$userInfo.value.username,createDate:"",changeDate:"",tag:"",like:0}),v="http://astralcyber.ml:3000",c=new Headers;c.append("Content-Type","application/json");async function z(l){let e={method:"GET",headers:c,redirect:"follow"};await fetch(`${v}/draft/${l}`,e).then(s=>s.json()).then(s=>{o.value=s}),g.value=!0}function I(l){T.value=fe(D.value).slice(l*4-4,l*4),l!==1?P.push({name:"DraftPage",params:{page:l}}):P.push({name:"Draft"})}async function $(){let l={method:"GET",headers:c,redirect:"follow"};await fetch(`${v}/draft/`,l).then(e=>e.json()).then(e=>{D.value=[];for(let s in e)e[s].authorUuid===r.$userInfo.value.id&&D.value.push(e[s]);_.value=D.value.length}),typeof w.params.page<"u"?I(w.params.page):I(1)}function k(){let l={method:"PATCH",headers:c,redirect:"follow"};l.body=JSON.stringify(r.$userInfo.value),fetch(`${v}/users/${r.$userInfo.value.id}`,l)}async function B(){let l={method:"DELETE",headers:c,redirect:"follow"};const e=o.value;l.body=JSON.stringify(e),await fetch(`${v}/draft/${o.value.id}`,l).then(()=>{d({message:"\u5E16\u5B50\u5220\u9664\u6210\u529F",type:"success"}),r.$userInfo.value.draft--,g.value=!1,_.value--,k()}).catch(s=>d({message:s,type:"error"})),(_.value%4===0||_.value%4===1)&&location.replace(location.origin+"/#/draft"),await $()}async function J(){if(o.value.topic===""){d({message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"error"});return}o.value.intro===""&&(o.value.intro=o.value.content.substring(0,155));let l={method:"DELETE",headers:c,redirect:"follow"},e={method:"Post",headers:c,redirect:"follow"};if(o.value.id!==""){const i=o.value;l.body=JSON.stringify(i),await fetch(`${v}/draft/${o.value.id}`,l).then(()=>{r.$userInfo.value.draft--,_.value--}).catch(C=>d({message:C,type:"error"}))}const s=o.value;s.id="",s.assort="Default",s.createDate=s.changeDate=q(new Date),e.body=JSON.stringify(s),await fetch(`${v}/article`,e).then(()=>{r.$userInfo.value.articles++,g.value=!1,d({message:"\u5E16\u5B50\u53D1\u5E03\u6210\u529F\uFF5E",type:"success"})}).catch(i=>d({message:i,type:"error"})),k(),_.value%4===0&&location.replace(location.origin+"/#/draft"),await $()}async function A(){if(o.value.topic===""){d({message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"error"});return}if(o.value.assort===""&&(o.value.assort="Default"),o.value.intro===""&&(o.value.intro=o.value.content.substring(0,155)),o.value.id!==""){let l={method:"PATCH",headers:c,redirect:"follow"};const e=o.value;e.changeDate=q(new Date),l.body=JSON.stringify(e),await fetch(`${v}/draft/${o.value.id}`,l).then(()=>{d({message:"\u5DF2\u4FDD\u5B58\u5230\u8349\u7A3F\u7BB1\uFF01",type:"success"})}).catch(s=>alert(s))}else{let l={method:"POST",headers:c,redirect:"follow"};const e=o.value;e.createDate=e.changeDate=q(new Date),l.body=JSON.stringify(e),await fetch(`${v}/draft/`,l).then(()=>{d({message:"\u5DF2\u4FDD\u5B58\u5230\u8349\u7A3F\u7BB1\uFF01",type:"success"}),r.$userInfo.value.draft++,_.value++,k()}).catch(s=>d({message:s,type:"error"}))}await $()}function F(){P.push({name:"Main"})}pe(()=>{$()});function G(l){return j+"?"+l+")"}return(l,e)=>{const s=W,i=Z,C=x("v-md-editor"),S=ee,H=te,u=ae,b=oe,M=le,L=x("User"),R=x("Folder"),Q=x("Paperclip"),X=x("EditPen"),Y=ne,K=se;return O(),U(N,null,[t(H,{width:"80vw",modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=n=>g.value=n),"align-center":"align-center",fullscreen:"fullscreen","close-on-click-modal":!1,onClose:e[5]||(e[5]=n=>o.value={authorUuid:E(r).$userInfo.value.id,topic:"",content:"",intro:"",assort:"",author:E(r).$userInfo.value.username,createDate:"",changeDate:"",tag:"",like:0})},{header:a(()=>[t(i,{align:"middle",style:{"margin-bottom":"10px"}},{default:a(()=>[ve,t(s,{style:{width:"30%","margin-left":"15px"},modelValue:o.value.topic,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.topic=n),clearable:"",min:"1"},{prepend:a(()=>[p("\u6807\u9898")]),_:1},8,["modelValue"]),t(s,{style:{width:"30%","margin-left":"15px"},modelValue:o.value.intro,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.intro=n),clearable:"","show-word-limit":""},{prepend:a(()=>[p("\u7B80\u4ECB")]),_:1},8,["modelValue"]),t(s,{style:{width:"20%","margin-left":"15px"},modelValue:o.value.assort,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.assort=n),clearable:"",maxlength:"8","show-word-limit":""},{prepend:a(()=>[p("\u5206\u7C7B")]),_:1},8,["modelValue"])]),_:1})]),footer:a(()=>[f("span",he,[t(S,{type:"danger",onClick:B},{default:a(()=>[p(" \u5220\u9664 ")]),_:1}),t(S,{type:"primary",onClick:J},{default:a(()=>[p(" \u53D1\u5E03 ")]),_:1})])]),default:a(()=>[t(i,{justify:"space-evenly",style:{"margin-bottom":"10px"}}),t(C,{modelValue:o.value.content,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.content=n),height:"80vh",onSave:A},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(i,{style:{height:"24px"},justify:"space-between",align:"middle"},{default:a(()=>[t(u,{span:6},{default:a(()=>[f("span",{class:"back",onClick:F}," \u2B05 \u85CF\u5178\u9601 ")]),_:1}),t(u,{span:10,style:{"text-align":"center"}},{default:a(()=>[f("span",ye,h(E(r).$userInfo.value.username)+"\u7684\u8349\u7A3F\u7BB1",1)]),_:1}),t(u,{span:6,style:{"text-align":"right"}},{default:a(()=>[t(S,{style:{"font-size":"larger"},type:"primary",onClick:e[6]||(e[6]=n=>g.value=!0),link:""},{default:a(()=>[p("\u53D1\u5E03\xA0 "),t(b,{style:{"margin-top":"2px"},size:20},{default:a(()=>[t(E(de))]),_:1})]),_:1})]),_:1})]),_:1}),t(M,{id:"divider","border-style":"dashed","content-position":"left"}),(O(!0),U(N,null,ce(T.value,n=>(O(),U("div",null,[t(i,{onClick:Ve=>z(n.id),style:{cursor:"pointer"}},{default:a(()=>[t(u,{span:24,style:{"margin-bottom":"20px"}},{default:a(()=>[t(Y,{class:"articleCard"},{default:a(()=>[t(i,null,{default:a(()=>[t(u,{span:10,class:"articleImgBox"},{default:a(()=>[f("img",{src:G(n.id),class:"articleImg"},null,8,we)]),_:2},1024),t(u,{span:14,style:{padding:"10px 15px 15px 15px"}},{default:a(()=>[f("h1",be,h(n.topic),1),f("div",xe,[f("span",De,h(n.intro),1),f("span",$e,[t(i,null,{default:a(()=>[t(u,{span:12},{default:a(()=>[t(b,{style:{top:"2px"}},{default:a(()=>[t(L)]),_:1}),p(" \u4F5C\u8005\uFF1A"+h(n.author),1)]),_:2},1024),t(u,{span:12},{default:a(()=>[t(b,{style:{top:"2px"}},{default:a(()=>[t(R)]),_:1}),p(" \u5206\u7C7B\uFF1A"+h(n.assort),1)]),_:2},1024),t(u,{span:12},{default:a(()=>[t(b,{style:{top:"2px"}},{default:a(()=>[t(Q)]),_:1}),p(" \u53D1\u5E03\u4E8E\uFF1A"+h(n.createDate),1)]),_:2},1024),t(u,{span:12},{default:a(()=>[t(b,{style:{top:"2px"}},{default:a(()=>[t(X)]),_:1}),p(" \u4FEE\u6539\u4E8E\uFF1A"+h(n.changeDate),1)]),_:2},1024)]),_:2},1024)])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]))),256)),t(i,{style:{width:"100%"},class:"pagination",align:"middle",justify:"center"},{default:a(()=>[t(K,{style:{transform:"scale(1.2,1.2)"},"hide-on-single-page":!0,"page-size":4,"current-page":V.value,"onUpdate:current-page":e[7]||(e[7]=n=>V.value=n),layout:"prev, pager, next",total:_.value,onCurrentChange:e[8]||(e[8]=n=>I(V.value))},null,8,["current-page","total"])]),_:1})],64)}}},Fe=ie(Ee,[["__scopeId","data-v-267b2c31"]]);export{Fe as default};
