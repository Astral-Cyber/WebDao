import{f as ee,g as te,h as ae,i as oe,m as le,j as ne,r as se,l as re,s as ie,e as ue,d as w}from"./element-plus.45547c91.js";import{u as pe}from"./vue-router.d32d5c8d.js";import{_ as ce,u as de,r as y}from"./index.0afe97ce.js";import{D as B}from"./Date.43b474cf.js";import{h as f,G as me,ac as x,o as T,c as P,V as e,T as a,Q as O,ae as fe,a5 as p,a as c,X as d,u as k,a8 as _e,a$ as ge,a_ as he}from"./@vue.e1fd017a.js";import"./@vueuse.ee407e82.js";import"./@element-plus.d2761a05.js";import"./@popperjs.36402333.js";import"./lodash-es.b61273cf.js";import"./@ctrl.fd318bfa.js";import"./js-md5.60c670bb.js";import"./@babel.102366c7.js";import"./@kangc.1d0d60da.js";import"./vue.f1ba8eca.js";import"./@vuepress.0f7d6c54.js";import"./highlight.js.f882a32c.js";import"./codemirror.a5fd94e6.js";import"./sakana-widget.756df383.js";const ve=b=>(ge("data-v-b492414d"),b=b(),he(),b),we=ve(()=>c("span",{id:"title",style:{"font-weight":"bolder","font-size":"24px",color:"#666666"}},"Editor",-1)),ye={class:"dialog-footer"},xe={style:{"font-weight":"bolder",color:"#666666","font-size":"x-large"}},be=["src"],Ee={style:{top:"0",color:"#666666","font-weight":"bolder","font-size":"24px","word-break":"break-all",overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"1","-webkit-box-orient":"vertical",margin:"0",height:"30px","line-height":"30px","word-wrap":"break-word"}},Ve={style:{height:"150px",width:"auto"}},$e={class:"introCard"},ke={style:{color:"#777777","font-size":"small",bottom:"10px",position:"absolute",width:"55%"}},Ce={__name:"AuthorView",setup(b){const E=f(!0),g=f(!1),r=de(),m=pe(),h=f(),S=f([]),V=f([]),C=f(parseInt(m.params.page||1));let F="https://source.unsplash.com/random/900x600/?desktop,wallparper";const o=f({id:"",authorUuid:r.$userInfo.value.id,topic:"",content:"",intro:"",assort:"",author:r.$userInfo.value.username,createDate:new Date,changeDate:new Date,tag:"",like:[],weight:0}),v="http://astralcyber.ml:3000",_=new Headers;_.append("Content-Type","application/json");async function j(n){let t={method:"GET",headers:_,redirect:"follow"};await fetch(`${v}/article/${n}`,t).then(s=>s.json()).then(s=>{origin=s,o.value=s}),g.value=!0,E.value=!0}function D(n){S.value=_e(V.value).slice(n*5-5,n*5),n!==1?y.push({name:"AuthorPage",params:{page:n}}):y.push({name:"Author"});let t;cancelAnimationFrame(t),t=requestAnimationFrame(function s(){let i=document.body.scrollTop||document.documentElement.scrollTop;i>0?(scrollTo(0,i-25),t=requestAnimationFrame(s)):cancelAnimationFrame(t)})}async function I(){let n={method:"GET",headers:_,redirect:"follow"};await fetch(`${v}/article/`,n).then(t=>t.json()).then(t=>{V.value=[];for(let s in t)t[s].authorUuid===r.$userInfo.value.id&&V.value.push(t[s]);h.value=V.value.length}),typeof m.params.page<"u"?D(m.params.page):D(1)}function q(){let n={method:"PATCH",headers:_,redirect:"follow"};n.body=JSON.stringify(r.$userInfo.value),fetch(`${v}/users/${r.$userInfo.value.id}`,n)}async function z(){let n={method:"DELETE",headers:_,redirect:"follow"};const t=o.value;n.body=JSON.stringify(t),await fetch(`${v}/article/${o.value.id}`,n).then(()=>{w({message:"\u7A3F\u7EB8\u5DF2\u88AB\u6298\u6210\u7EB8\u98DE\u673A\uFF5E",type:"success"}),r.$reload.value=!r.$reload.value,r.$userInfo.value.articles--,E.value=!1,g.value=!1,h.value--,q()}).catch(s=>w({message:s,type:"error"})),h.value%5===0&&m.params.page>2&&await y.push({name:m.name,params:{page:m.params.page-1}}),h.value%5===0&&m.params.page===2&&await y.push({name:"Author"}),await I()}async function A(){if(o.value.topic===""){w({message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"error"});return}o.value.assort===""&&(o.value.assort="Default"),o.value.intro===""&&(o.value.intro=o.value.content.substring(0,155));let n={method:"PATCH",headers:_,redirect:"follow"};const t=o.value;t.changeDate=new Date,n.body=JSON.stringify(t),await fetch(`${v}/article/${o.value.id}`,n).then(()=>{w({message:"\u5DF2\u4FDD\u5B58\u4FEE\u6539\uFF01",type:"success"})}).catch(s=>w({message:s,type:"error"})),await I()}function N(){A(),E.value=!1,g.value=!1}function G(){(o.value.content!==""||o.value.topic!=="")&&E.value&&ue.confirm("\u5185\u5BB9\u672A\u4FDD\u5B58\uFF0C"+r.$userInfo.value.username+"\u771F\u7684\u8981\u8D70\u5417\uFF1F","Warning",{confirmButtonText:"\u72E0\u5FC3\u79BB\u5F00",cancelButtonText:"\u4FDD\u5B58\u5E76\u79BB\u5F00",type:"warning",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}).catch(()=>{A()})}function M(){y.push({name:"Main"})}me(()=>{I()});function H(n){return F+","+n+")"}return(n,t)=>{const s=ee,i=te,J=x("v-md-editor"),U=ae,R=oe,u=le,L=ne,Q=x("User"),$=se,W=x("Folder"),X=x("Paperclip"),K=x("EditPen"),Y=re,Z=ie;return T(),P(O,null,[e(R,{width:"80vw",modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=l=>g.value=l),"align-center":"align-center",fullscreen:"fullscreen","close-on-click-modal":!1,onClose:G},{header:a(()=>[e(i,{align:"middle",style:{"margin-bottom":"10px"}},{default:a(()=>[we,e(s,{style:{width:"30%","margin-left":"15px"},modelValue:o.value.topic,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.topic=l),clearable:"",min:"1"},{prepend:a(()=>[p("\u6807\u9898")]),_:1},8,["modelValue"]),e(s,{style:{width:"30%","margin-left":"15px"},modelValue:o.value.intro,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.intro=l),clearable:"","show-word-limit":""},{prepend:a(()=>[p("\u7B80\u4ECB")]),_:1},8,["modelValue"]),e(s,{style:{width:"20%","margin-left":"15px"},modelValue:o.value.assort,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.assort=l),clearable:"",maxlength:"8","show-word-limit":""},{prepend:a(()=>[p("\u5206\u7C7B")]),_:1},8,["modelValue"])]),_:1})]),footer:a(()=>[c("span",ye,[e(U,{size:"large",type:"danger",onClick:z},{default:a(()=>[p(" \u5220\u9664 ")]),_:1}),e(U,{size:"large",type:"primary",onClick:N},{default:a(()=>[p(" \u4FEE\u6539 ")]),_:1})])]),default:a(()=>[e(i,{justify:"space-evenly",style:{"margin-bottom":"10px"}}),e(J,{modelValue:o.value.content,"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.content=l),height:"77vh",onSave:A},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(i,{style:{height:"24px"},justify:"space-between",align:"middle"},{default:a(()=>[e(u,{span:6},{default:a(()=>[c("span",{class:"back",onClick:M}," \u2B05 \u85CF\u5178\u9601 ")]),_:1}),e(u,{span:10,style:{"text-align":"center"}},{default:a(()=>[c("span",xe,d(k(r).$userInfo.value.username)+"\u5DF2\u6295\u9001"+d(k(r).$userInfo.value.articles)+"\u7BC7",1)]),_:1}),e(u,{span:6,style:{"text-align":"right"}})]),_:1}),e(L,{id:"divider","border-style":"dashed","content-position":"left"}),(T(!0),P(O,null,fe(S.value,l=>(T(),P("div",null,[e(i,{onClick:De=>j(l.id),style:{cursor:"pointer"}},{default:a(()=>[e(u,{span:24,style:{"margin-bottom":"20px"}},{default:a(()=>[e(Y,{class:"articleCard"},{default:a(()=>[e(i,null,{default:a(()=>[e(u,{span:10,class:"articleImgBox"},{default:a(()=>[c("img",{src:H(l.topic),class:"articleImg"},null,8,be)]),_:2},1024),e(u,{span:14,style:{padding:"10px 15px 15px 15px"}},{default:a(()=>[c("h1",Ee,d(l.topic),1),c("div",Ve,[c("span",$e,d(l.intro),1),c("span",ke,[e(i,null,{default:a(()=>[e(u,{span:12},{default:a(()=>[e($,{style:{top:"2px"}},{default:a(()=>[e(Q)]),_:1}),p(" \u4F5C\u8005\uFF1A"+d(l.author),1)]),_:2},1024),e(u,{span:12},{default:a(()=>[e($,{style:{top:"2px"}},{default:a(()=>[e(W)]),_:1}),p(" \u5206\u7C7B\uFF1A"+d(l.assort),1)]),_:2},1024),e(u,{span:12},{default:a(()=>[e($,{style:{top:"2px"}},{default:a(()=>[e(X)]),_:1}),p(" \u5EFA\u7ACB\u4E8E\uFF1A"+d(k(B)(new Date(l.createDate))),1)]),_:2},1024),e(u,{span:12},{default:a(()=>[e($,{style:{top:"2px"}},{default:a(()=>[e(K)]),_:1}),p(" \u4FEE\u6539\u4E8E\uFF1A"+d(k(B)(new Date(l.changeDate))),1)]),_:2},1024)]),_:2},1024)])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]))),256)),e(i,{style:{width:"100%"},class:"pagination",align:"middle",justify:"center"},{default:a(()=>[e(Z,{style:{transform:"scale(1.2,1.2)"},"hide-on-single-page":!0,"page-size":5,"current-page":C.value,"onUpdate:current-page":t[5]||(t[5]=l=>C.value=l),layout:"prev, pager, next",total:h.value,onCurrentChange:t[6]||(t[6]=l=>D(C.value))},null,8,["current-page","total"])]),_:1})],64)}}},Le=ce(Ce,[["__scopeId","data-v-b492414d"]]);export{Le as default};
