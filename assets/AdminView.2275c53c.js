import{f as ae,g as oe,h as le,i as ne,m as se,j as re,r as ie,l as pe,s as ue,d as c,e as ce}from"./element-plus.45547c91.js";import{u as de}from"./vue-router.d32d5c8d.js";import{_ as me,u as fe,r as E}from"./index.0afe97ce.js";import{D as j}from"./Date.43b474cf.js";import{h,G as ge,ac as $,o as k,c as P,V as t,T as o,Q as B,ae as he,a5 as i,a as d,S as q,P as z,X as _,u as F,a$ as _e,a_ as ve}from"./@vue.e1fd017a.js";import"./@vueuse.ee407e82.js";import"./@element-plus.d2761a05.js";import"./@popperjs.36402333.js";import"./lodash-es.b61273cf.js";import"./@ctrl.fd318bfa.js";import"./js-md5.60c670bb.js";import"./@babel.102366c7.js";import"./@kangc.1d0d60da.js";import"./vue.f1ba8eca.js";import"./@vuepress.0f7d6c54.js";import"./highlight.js.f882a32c.js";import"./codemirror.a5fd94e6.js";import"./sakana-widget.756df383.js";const ye=C=>(_e("data-v-d43c19cf"),C=C(),ve(),C),we=ye(()=>d("span",{id:"title",style:{"font-weight":"bolder","font-size":"24px",color:"#666666"}},"Editor",-1)),xe={class:"dialog-footer"},be={style:{"font-weight":"bolder",color:"#666666","font-size":"x-large"}},Ee=["src"],$e={style:{top:"0",color:"#666666","font-weight":"bolder","font-size":"24px","word-break":"break-all",overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"1","-webkit-box-orient":"vertical",margin:"0",height:"30px","line-height":"30px","word-wrap":"break-word"}},ke={style:{height:"150px",width:"auto"}},Ce={class:"introCard"},Ve={style:{color:"#777777","font-size":"small",bottom:"10px",position:"absolute",width:"55%"}},Ae={__name:"AdminView",setup(C){const b=h(!0),v=h(!1),y=fe(),f=de(),w=h(),S=h([]);h([]);const T=h(parseInt(f.params.page||1));let H="https://source.unsplash.com/random/900x600/?desktop,wallparper";const a=h({id:"",authorUuid:y.$userInfo.value.id,topic:"",content:"",intro:"",assort:"",author:y.$userInfo.value.username,createDate:new Date,changeDate:new Date,tag:"",like:[],weight:0}),g="http://astralcyber.ml:3000",m=new Headers;m.append("Content-Type","application/json");async function N(n){let e={method:"GET",headers:m,redirect:"follow"};await fetch(`${g}/article/${n}`,e).then(s=>s.json()).then(s=>{origin=s,a.value=s}),v.value=!0,b.value=!0}function I(n){const e="http://astralcyber.ml:3000",s=new Headers;s.append("Content-Type","application/json");let r={method:"GET",headers:s,redirect:"follow"};fetch(`${e}/article/?_sort=weight&_order=desc&_page=${n}&_limit=5`,r).then(p=>p.json()).then(p=>{S.value=p,n!==1?E.push({name:"AdminPage",params:{page:n}}):E.push({name:"Admin"})});let x;cancelAnimationFrame(x),x=requestAnimationFrame(function p(){let A=document.body.scrollTop||document.documentElement.scrollTop;A>0?(scrollTo(0,A-25),x=requestAnimationFrame(p)):cancelAnimationFrame(x)})}async function V(){let n={method:"GET",headers:m,redirect:"follow"};await fetch(`${g}/article/`,n).then(e=>e.json()).then(e=>{w.value=e.length}).catch(e=>{c({message:e,type:"error"})}),typeof f.params.page<"u"?I(f.params.page):I(1)}async function G(n){let e;await fetch(`${g}/users/${n}`,{method:"GET",headers:m,redirect:"follow"}).then(r=>r.json()).then(r=>{e=r}).catch(r=>{c({message:r,type:"error"})});let s={method:"PATCH",headers:m,redirect:"follow"};e.articles--,s.body=JSON.stringify(e),await fetch(`${g}/users/${e.id}`,s)}async function M(){let n={method:"DELETE",headers:m,redirect:"follow"};const e=a.value;n.body=JSON.stringify(e),await fetch(`${g}/article/${a.value.id}`,n).then(()=>{c({message:"\u7A3F\u7EB8\u5DF2\u88AB\u6298\u6210\u7EB8\u98DE\u673A\uFF5E",type:"success"}),y.$reload.value=!y.$reload.value,y.$allHas.value--,b.value=!1,v.value=!1,w.value--,G(a.value.authorUuid)}).catch(s=>c({message:s,type:"error"})),w.value%5===0&&f.params.page>2&&await E.push({name:f.name,params:{page:f.params.page-1}}),w.value%5===0&&f.params.page===2&&await E.push({name:"Admin"}),await V()}async function O(){if(a.value.topic===""){c({message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"error"});return}a.value.assort===""&&(a.value.assort="Default"),a.value.intro===""&&(a.value.intro=a.value.content.substring(0,155));let n={method:"PATCH",headers:m,redirect:"follow"};const e=a.value;e.changeDate=new Date,n.body=JSON.stringify(e),await fetch(`${g}/article/${a.value.id}`,n).then(()=>{c({message:"\u5DF2\u4FDD\u5B58\u4FEE\u6539\uFF01",type:"success"})}).catch(s=>c({message:s,type:"error"})),await V()}function J(){O(),b.value=!1,v.value=!1}async function U(n){if(a.value.topic===""){c({message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"error"});return}a.value.assort===""&&(a.value.assort="Default"),a.value.intro===""&&(a.value.intro=a.value.content.substring(0,155));let e={method:"PATCH",headers:m,redirect:"follow"};const s=a.value;s.weight=n,e.body=JSON.stringify(s),await fetch(`${g}/article/${a.value.id}`,e).then(()=>{c({message:n===0?"\u5DF2\u53D6\u6D88\u7F6E\u9876\uFF5E":"\u5DF2\u7F6E\u9876\uFF5E",type:n===0?"warning":"success"})}).catch(r=>c({message:r,type:"error"})),await V(),b.value=!1,v.value=!1}function L(){(a.value.content!==""||a.value.topic!=="")&&b.value&&ce.confirm("\u5185\u5BB9\u672A\u4FDD\u5B58\uFF0C"+y.$userInfo.value.username+"\u771F\u7684\u8981\u8D70\u5417\uFF1F","Warning",{confirmButtonText:"\u72E0\u5FC3\u79BB\u5F00",cancelButtonText:"\u4FDD\u5B58\u5E76\u79BB\u5F00",type:"warning",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}).catch(()=>{O()})}function R(){E.push({name:"Main"})}ge(()=>{V()});function Q(n){return H+","+n+")"}return(n,e)=>{const s=ae,r=oe,x=$("v-md-editor"),p=le,A=ne,u=se,W=re,X=$("User"),D=ie,K=$("Folder"),Y=$("Paperclip"),Z=$("EditPen"),ee=pe,te=ue;return k(),P(B,null,[t(A,{width:"80vw",modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value=l),"align-center":"align-center",fullscreen:"fullscreen","close-on-click-modal":!1,onClose:L},{header:o(()=>[t(r,{align:"middle",style:{"margin-bottom":"10px"}},{default:o(()=>[we,t(s,{style:{width:"30%","margin-left":"15px"},modelValue:a.value.topic,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.topic=l),clearable:"",min:"1"},{prepend:o(()=>[i("\u6807\u9898")]),_:1},8,["modelValue"]),t(s,{style:{width:"30%","margin-left":"15px"},modelValue:a.value.intro,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.intro=l),clearable:"","show-word-limit":""},{prepend:o(()=>[i("\u7B80\u4ECB")]),_:1},8,["modelValue"]),t(s,{style:{width:"20%","margin-left":"15px"},modelValue:a.value.assort,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.assort=l),clearable:"",maxlength:"8","show-word-limit":""},{prepend:o(()=>[i("\u5206\u7C7B")]),_:1},8,["modelValue"])]),_:1})]),footer:o(()=>[d("span",xe,[t(p,{size:"large",type:"danger",onClick:M},{default:o(()=>[i(" \u5220\u9664 ")]),_:1}),t(p,{size:"large",type:"primary",onClick:J},{default:o(()=>[i(" \u4FEE\u6539 ")]),_:1}),a.value.weight===0?(k(),q(p,{key:0,size:"large",type:"success",onClick:e[4]||(e[4]=l=>U(9999999999))},{default:o(()=>[i(" \u7F6E\u9876 ")]),_:1})):z("",!0),a.value.weight!==0?(k(),q(p,{key:1,size:"large",type:"warning",onClick:e[5]||(e[5]=l=>U(0))},{default:o(()=>[i(" \u53D6\u6D88\u7F6E\u9876 ")]),_:1})):z("",!0)])]),default:o(()=>[t(r,{justify:"space-evenly",style:{"margin-bottom":"10px"}}),t(x,{modelValue:a.value.content,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.content=l),height:"77vh",onSave:O},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(r,{style:{height:"24px"},justify:"space-between",align:"middle"},{default:o(()=>[t(u,{span:6},{default:o(()=>[d("span",{class:"back",onClick:R}," \u2B05 \u85CF\u5178\u9601 ")]),_:1}),t(u,{span:10,style:{"text-align":"center"}},{default:o(()=>[d("span",be,"\u601D\u91CFDAO\u5DF2\u6536\u5230\u6295\u9001"+_(w.value)+"\u7BC7",1)]),_:1}),t(u,{span:6,style:{"text-align":"right"}})]),_:1}),t(W,{id:"divider","border-style":"dashed","content-position":"left"}),(k(!0),P(B,null,he(S.value,l=>(k(),P("div",null,[t(r,{onClick:De=>N(l.id),style:{cursor:"pointer"}},{default:o(()=>[t(u,{span:24,style:{"margin-bottom":"20px"}},{default:o(()=>[t(ee,{class:"articleCard"},{default:o(()=>[t(r,null,{default:o(()=>[t(u,{span:10,class:"articleImgBox"},{default:o(()=>[d("img",{src:Q(l.topic),class:"articleImg"},null,8,Ee)]),_:2},1024),t(u,{span:14,style:{padding:"10px 15px 15px 15px"}},{default:o(()=>[d("h1",$e,_(l.topic),1),d("div",ke,[d("span",Ce,_(l.intro),1),d("span",Ve,[t(r,null,{default:o(()=>[t(u,{span:12},{default:o(()=>[t(D,{style:{top:"2px"}},{default:o(()=>[t(X)]),_:1}),i(" \u4F5C\u8005\uFF1A"+_(l.author),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(D,{style:{top:"2px"}},{default:o(()=>[t(K)]),_:1}),i(" \u5206\u7C7B\uFF1A"+_(l.assort),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(D,{style:{top:"2px"}},{default:o(()=>[t(Y)]),_:1}),i(" \u5EFA\u7ACB\u4E8E\uFF1A"+_(F(j)(new Date(l.createDate))),1)]),_:2},1024),t(u,{span:12},{default:o(()=>[t(D,{style:{top:"2px"}},{default:o(()=>[t(Z)]),_:1}),i(" \u4FEE\u6539\u4E8E\uFF1A"+_(F(j)(new Date(l.changeDate))),1)]),_:2},1024)]),_:2},1024)])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]))),256)),t(r,{style:{width:"100%"},class:"pagination",align:"middle",justify:"center"},{default:o(()=>[t(te,{style:{transform:"scale(1.2,1.2)"},"hide-on-single-page":!0,"page-size":5,"current-page":T.value,"onUpdate:current-page":e[7]||(e[7]=l=>T.value=l),layout:"prev, pager, next",total:w.value,onCurrentChange:e[8]||(e[8]=l=>I(T.value))},null,8,["current-page","total"])]),_:1})],64)}}},Qe=me(Ae,[["__scopeId","data-v-d43c19cf"]]);export{Qe as default};
